# 机器人学导论学习笔记 Part 1

## Chapter 1 概述

### 1.2 操作臂的力学与控制

#### 位置和姿态的描述

为了描述空间物体的位置和姿态，一般在物体上设置一个**坐标系**（或位姿），然后在某个参考坐标系中描述该位姿的位置与姿态。任一位姿都能用作研究物体位置和姿态的参考坐标系，因此需要把一个位姿变换到另一个位姿。

#### 操作臂正运动学

**运动学**研究物体的运动，而不考虑引起该运动的力。也即研究位置、速度、加速度和位置变量对于时间或者其他变量的高阶微分，因此研究对象是运动的全部几何和时间特性。

操作臂由刚性**连杆**组成，相邻连杆间由**关节**连接。**转动关节**的位移被称作**关节角**。**移动关节**的相对位移被称作**关节偏移量**。

操作臂的**自由度**是操作臂中具有**独立位置变量的数目**，这些位置变量确定了机构中所有部件的位置。由于操作臂大都是开式的运动链，而且每个关节位置都由唯一一个变量来定义，因此关节数目等于自由度数目。

组成操作臂的运动链的自由端称为**末端执行器**，通常在末端执行器上设置**工具坐标系**（相对于设置于操作臂固定基底的**基坐标系**）来描述操作臂的位置。

**正运动学**是一个计算操作臂末端执行器位置和姿态的静态几何问题。也即给定一组关节角的值，正运动学计算工具坐标系相对于基坐标系的位置和姿态。也将此过程称为从**关节空间**描述到**笛卡尔空间描述**（或任务空间、操作空间）。

#### 操作臂逆运动学

**逆运动学**是给定末端执行器的位置和姿态，计算所有可达给定位置和姿态的关节角。逆运动学的求解对于操作臂系统来说是最重要的因素，它是个“定位”映射问题，将机器人位姿从三维笛卡尔空间向关节空间的映射。由于运动学方程是非线性的，难以找到封闭解，有时甚至无解，因此需要判断是否有解、多解。

运动学方程解的有无定义了操作臂的**工作空间**。无解表示操作臂不能达到这个期望的位置和姿态，因为目标点位于操作臂的工作空间之外。

#### 速度、静力学、奇异点

为操作臂定义**雅可比矩阵**可以进行机构的速度分析，它定义了从关节空间速度向笛卡尔空间速度的映射，这种映射关系随着操作臂位形的变化而变化。在**奇异点**，映射是不可逆的。

当机构处于奇异的位姿时，如具有仰角和方向角的机枪竖直向上时，机枪的朝向与方位转轴共线，也即在该点时，方位转动改变不了机枪的方向，一个转动关节失效了。在这种位置，机构出现**局部退化**，就像只有一个自由度一样。

上述现象是由**机构奇异点**造成的，所有的机械装置都会有这种问题，奇异点并不影响机器人手臂在其工作空间内的定位，然而，在这些奇异点周围运动时就会产生一些问题。

为了解决如何设定关节力矩来产生要求的接触力和力矩，同样需要使用操作臂的雅可比矩阵。

#### 动力学

**动力学**研究产生运动所需的力。为了使操作臂从静止开始加速，使末端执行器以恒定的速度运动，最后减速停止，**关节驱动器**必须产生一组复杂的**扭矩函数**来实现。扭矩函数的形式取决于末端执行器路径的空间运动形式和瞬时特性、连杆的质量特性和负载以及关节摩擦等因素。控制操作臂沿期望路径运动的一种方法是，通过运用操作臂动力学方程求解出这些关节扭矩函数。

对于负载的误判可能引起异常的抓举动作（如误判了质量），因此，实际控制系统比纯粹的运动规划更复杂。机器人操作臂运动控制算法也应当把动力学考虑进去。

动力学方程的第二个用途是**仿真**。通过重构动力学方程可以计算加速度，加速度是驱动力矩的函数，这样就可以在一组驱动力矩作用下对操作臂的运动进行仿真。

#### 轨迹生成

平稳控制操作臂从一点运动到另一点，通常的方法是使每个关节按照指定的时间连续函数来运动。一般情况下，操作臂的各个关节同时开始和停止运动，使得运动协调。**轨迹生产**就是准确计算出这些运动函数。

通常，一条路径的描述不仅需要确定期望目标点，而且还需要确定一些中间点或**路径点**，操作臂必须通过这条路径点到达目标点，有时用**样条函数**表示通过一系列路径点的连续函数。

为了使得末端执行器在空间中走出一个特定轨迹，必须将其期望运动转化为一系列等效的关节运动，这叫做**笛卡尔轨迹生成**。

#### 操作臂设计与传感器

操作臂的机械设计是由期望执行的任务决定的。机器人分为两种，一种是为特定任务设计的专用机器人，另一种是能够完成各种任务的通用机器人。对于通用机器人，最小的关节数量是6个。完整的操作臂设计包括以下因素：驱动器的选择和位置、传递系统以及内部位置传感器（力传感器）。

#### 线性位置控制

绝大多数操作臂是由驱动器来驱动的，这些驱动器提供力或力矩驱动连杆运动，动力学是计算用于产生期望运动的力矩的核心。但只有动力学是不够的，设计**位置控制系统**首先要考虑自动补偿由于系统参数引起的**误差**以及抑制引起系统偏离期望轨迹的**扰动**。我i为此，通过**控制算法**对位置和速度**传感器**进行检测，并计算出驱动器的扭矩指令，一般的控制算法是基于操作臂动力学的线性近似得出的，称作线性控制。

#### 非线性位置控制

尽管基于近似线性模型的控制系统已经广泛应用，但在进行控制算法设计时，考虑操作臂完整的非线性动力学很重要，也即**非线性控制算法**，它通常具有更好的性能。

#### 力控制

**力控制**与位置控制是互补的，在特定情况下，只有力控制或位置控制是合适的。当操作臂在自由空间运动时，只有位置控制有意义。而当操作臂接触某些表面时，就必须使用力控制。由于操作臂很少同时在所有方向都受到作用表面约束，因此就需要**混合控制**。混合控制在某些方向采用位置控制，其余方向采用力控制。如机器人擦窗户，应当在垂直于窗户平面的方向施加恒定的力，同时在平行于窗户平面的方向走出一条运动轨迹。

#### 机器人编程

**机器人编程语言**是用户与机器人交互的接口。机器人与**刚性自动化**的不同之处在于其具有“柔性”，也即可编程。

在典型的机器人系统中，操作者可以用一种快速方法来操作机器人的路径。首先，将操作臂末端执行器上的一个特殊点作为**操作点**，有时也叫做**TCP（工具中心点）**。通过操作点相对于用户坐标系的期望位置来描述机器人的运动。通常，可以在某个与任务相关的位置定义这个与机器人基坐标系相关的参考坐标系。

大多数情况下，路径是通过一系列的**路径点**生成的，路径点是相对于参考坐标系确定的，是TCP经过的指定位置。除了要确定路径点之外，还需要确定不同路径段上TCP的速度。依据这些输入，轨迹生成算法必须规划出机器人运动的所有细节：通过各点的速度曲线、运动时间等。

#### 离线编程与仿真

离线编程系统是一种机器人编程环境，这种环境通常要采用CV的技术，即使不占用机器人本体也能够对机器人编程，其好处在于离线编程系统不需要生产设备停机。

### 1.3 符号约定

以下的符号约定是贯穿始终的！！！

1. 大写字母的变量表示矢量或矩阵，小写字母表示标量。
2. 矢量如果有帽号，也即形如$\hat X$，则意味着它是单位矢量。
3. 左上标、左下标表示变量所在的坐标系。如$^AP$表示坐标系$\{A\}$中的位置矢量，$^A_BR$表示坐标系$\{A\}\to\{B\}$的旋转矩阵。
4. 右上标表示矩阵的逆或转置。
5. 三角函数：$\cos\theta_1=c\theta_1=c_1$。
6. 矢量视作列向量，且矢量符号都带有参考系信息，也即只有在同一个坐标系下才可以进行矢量加法，以此可以在推导时解决坐标系问题，并且将其直接应用于数值计算。

### 参考文献

主要的期刊：

1. *IEEE/ASME Transactions on Mechatronics*，JCR Q1，中科院1区，IF 6.1
2. *IEEE Transactions on Robotics and Automation*，JCR Q1，中科院1区，IF 9.4 
3. *International Jounal of Robotics Research*，JCR Q1，中科院1区，IF 7.5
4. *ASME Journal of Dynamic Systems, Measurement, and Control*，JCR Q3，中科院4区，IF 1.7？？？？？？
5. *International Journal of Robotics & Automation*，JCR Q4，中科院4区，IF 0.8？？？？？？？？？？？？？？？？？？

## Chapter 2 空间描述和变换

我们考虑在一个世界坐标系中讨论。

### 2.2 描述：位置、姿态与位姿

**描述**可以用来确定一个操作系统处理的各种对象的特性。位姿则是位置和姿态描述的统一体。

#### 位置描述

建立坐标系后，可以使用一个$3\times1$的**位置矢量**描述坐标系中任何点。如$^AP=(p_x,p_y,p_z)^T$是在坐标系$\{A\}$中某一点的位置矢量。

#### 姿态描述

为了描述物体的姿态，在物体上固定一个坐标系并且给出此坐标系相对于参考坐标系的描述。点的位置可以使用矢量描述，物体的姿态可以用固定在物体上的坐标系来描述。

用$\hat X_B,\hat Y_B,\hat Z_B$表示坐标系$\{B\}$主轴方向的单位矢量，当以坐标系$\{A\}$作为参考坐标系时，它们是$^A\hat X_B,^A\hat Y_B,^A\hat Z_B$，将其写作一个$3\times3$的矩阵，则是**旋转矩阵**。记作：
$$
^A_B R=\left[ \begin{array} {c c} {{{^{A} \hat{X}_{B}}}} & {{{^{A} \hat{Y}_{B}}}} & {{{^{A} \hat{Z}_{B}}}} \\ \end{array} \right]=\left[ \begin{array} {c} {{{r_{1 1} \; \; r_{1 2} \; \; r_{1 3}}}} \\ {{{r_{2 1} \; \; r_{2 2} \; \; r_{2 3}}}} \\ {{{r_{3 1} \; \; r_{3 2} \; \; r_{3 3}}}} \\ \end{array} \right]\label{eq2.2}\tag{2.2}
$$
<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113020836.png" alt="image-20240809113020836" style="zoom:50%;" />

于是，点的位置可以用一个矢量来表示，物体的姿态可以用一个矩阵来表示。在式$\ref{eq2.2}$中，标量$r_{ij}$可以用每个矢量在其参考坐标系中轴线方向上投影的分量来表示，也即用一对单位矢量的点积来表示：

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113042954.png" alt="image-20240809113042954" style="zoom:67%;" />

由于两个单位矢量的点积可以得到二者之间夹角的余弦，因此旋转矩阵的各个分量也被称作**方向余弦**。

可以证明，$^A_BR= {^B_AR^T}$，也即交换参考坐标系后相当于对于原来的旋转矩阵进行转置。不难发现，旋转矩阵还是正交矩阵，也即其逆矩阵等于其转置。

#### 位姿描述

在物体上任选一点作为连体坐标系的原点，由于位置和姿态经常成对出现，于是我们将此组合称作**位姿**。4个矢量成一组，表示了位置和姿态信息，一个位姿可以等价地用一个位置矢量和一个旋转矩阵来描述。如$\{B\}=\{^A_BR,^AP_{BORG}\}$描述了位姿$\{B\}$，其中$^AP_{BORG}$是确定位姿$\{B\}$原点的位置矢量。

位姿也可以使用图解表示法，三个单位矢量定义位姿的三根主轴，从参考坐标系原点到位姿原点的箭头表示该位姿所处的位置。

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113059918.png" alt="image-20240809113059918" style="zoom:47%;" />

总之，位姿可以用两个坐标系的相对关系来描述，位姿包括了位置和姿态两个概念。位置是一个特殊的位姿，它的旋转矩阵是单位阵，并且位置矢量确定了被描述点的位置；同样，如果位姿的位置矢量是零矢量，那么它表示的就是姿态本身。

### 2.3 映射：从一个坐标系到另一个坐标系的变换

#### 坐标平移

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113122576.png" alt="image-20240809113122576" style="zoom:50%;" />

当$\{A\},\{B\}$的姿态相同时，我们希望在$\{A\}$中描述$^BP$矢量，用$^AP_{BORG}$表示$\{B\}$的原点相对于$\{A\}$的位置（也即平移量）。因为两个矢量所在的坐标系具有相同的姿态，因此：
$$
^AP={^BP}+{^AP_{BORG}}
$$
注意：不同坐标系中的矢量只有在坐标系的姿态相同的特殊情况下才可以直接相加。

映射就是描述一个坐标系到另一个坐标系的变换，被描述的物理量本身没有改变，但是它的描述改变了。对于坐标系平移而言，矢量$^AP_{BORG}$定义了这个映射，因为它包含了进行变换所需的所有信息。

#### 坐标旋转

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113146757.png" alt="image-20240809113146757" style="zoom:50%;" />

如图所示，两个坐标系的原点重合，仅有姿态不同，我们已知坐标系$\{B\}$相对于$\{A\}$的旋转矩阵：
$$
^A_B R=\left[ \begin{array} {c c} {{{^{A} \hat{X}_{B}}}} & {{{^{A} \hat{Y}_{B}}}} & {{{^{A} \hat{Z}_{B}}}} \\ \end{array} \right]=\left[ \begin{array}{c} {^B\hat X^T_A}\\{^B\hat Y^T_A} \\{^B\hat Z^T_A}\end{array}\right]
$$
于是有：
$$
^AP={^A_BR}{^BP}
$$
上式将空间某点相对于$\{B\}$的描述转换成了相对与$\{A\}$的描述，这种符号表示有助于跟踪映射过程和参考坐标系的变化，似乎就是坐标系$B$在左下标和左上标被消去了。

还是要强调，原矢量在空间中并没有变化，只是换了一个坐标系对其进行描述！同时注意，由于矩阵的乘法不具有交换律，因此旋转矩阵一般也不具有交换律，也即旋转的顺序是必要的。

#### 一般变换

对于一般的情况，两个坐标系的原点不重合，同时姿态也不一样。

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113200383.png" alt="image-20240809113200383" style="zoom:50%;" />

此时需要进行两次变换，也即先将姿态变换到与参考坐标系一致，再对其进行平移。
$$
^AP={^A_BR{^BP}}+{^AP_{BORG}}
$$
上式是一般的坐标变换映射，对上式进一步简化得到：
$$
^AP={^A_BT}{^BP}
$$
也即用一个矩阵形式的算子表示从一个坐标系到另一个坐标系的映射，这种表示更加简洁，其中使用了$4\times4$的矩阵算子和$4\times1$的位置矢量，上式等价于：
$$
\left(\begin{array}{c} ^AP\\1\end{array}\right)=\left(\begin{array}{ccc:c} & {^A_BR}& &{^AP_{BORG}} \\\hdashline0& 0& 0&1 \end{array}\right)\left(\begin{array}{c} ^BP\\1\end{array}\right)
$$
上式中$4\times4$的矩阵被称为**齐次变换矩阵**。它可以被视作以矩阵形式表示了一般变换的旋转和平移，在其他领域，它也可以被用来计算透视和放大。经过齐次变换矩阵形式简洁，但是一般在编程时不这样计算，因为0、1的相乘本身浪费时间且无意义。

正如使用旋转矩阵定义姿态一样，我们使用变换（如齐次变换矩阵）来定义一个坐标系。

### 2.4 算子：平移、旋转和变换

用于坐标系间点的映射的通用数学表达式称为算子，包括点的平移算子、矢量旋转算子和平移加旋转算子。

#### 平移算子

平移将空间中的一个点沿着一个已知的矢量方向移动一定的距离。空间点的平移与将此点向另一个坐标系的映射具有相同的数学描述，区分在于：当一个点相对于坐标系“向前移动”时，也可以认为是坐标系相对于这个点“向后移动”，二者的数学表达是相同的。

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113220484.png" alt="image-20240809113220484" style="zoom:50%;" />

上图表示了矢量$^AP_1$通过矢量$^AQ$进行平移，这里$^AQ$给出了平移的信息，平移之后得到一个新的矢量：
$$
^AP_2={^AP_1}+{^AQ}
$$
用矩阵算子表示如下：
$$
^AP_2=D_Q(q){^AP_1}=\left(\begin{array}{cccc} 1&0&0&q_x\\0 &1&0&q_y\\0&0&1&q_z\\0&0&0&1 \end{array}\right){^AP_1}
$$
其中$q_x,q_y,q_z$是平移矢量$Q$的分量，$q=\sqrt{q_x^2+q_y^2+q_z^2}$。算子$D_Q$可以被看做是一个特殊形式的齐次变换矩阵。

#### 旋转算子

旋转矩阵可以用旋转算子来定义，它将一个矢量$^AP_1$用旋转$R$变换成一个新的矢量$^AP_2$，通常，当一个旋转矩阵作为算子时，就无需写出上下标，因为它不涉及两个坐标系的变换。因此：
$$
^AP_2=R{^AP_1}
$$
实际上与平移类似，上式与坐标变换中的数学形式相同，只是解释方式不同。获得作为算子的旋转矩阵的方法：矢量经过某一旋转$R$得到的旋转矩阵与描述某个坐标系相对于参考坐标系旋转$R$所得到的旋转矩阵是相同的。为了明确是绕着哪个轴进行旋转，使用下式进行表示：
$$
^AP_2=R_K(\theta){^AP_1}
$$
其中$R_K(\theta)$是一个旋转算子，他表示绕$\hat K$轴旋转$\theta$角度，可以将其写作齐次变换矩阵，其中位置矢量的分量为0，例如，绕$\hat Z$轴旋转的算子是：
$$
R_z(\theta)=\left(\begin{array}{cccc} c\theta&-s\theta&0&0\\s\theta&c\theta&0&0\\0&0&1&0\\0&0&0&1\end{array}\right)
$$
<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113234779.png" alt="image-20240809113234779" style="zoom:50%;" />

#### 变换算子

算子$T$将矢量$^AP_1$平移并且旋转得到一个新的矢量：
$$
^AP_2=T{^AP_1}
$$
获得作为算子的齐次变换矩阵：包含旋转$R$和平移$Q$的变换与描述某个坐标系相对于参考坐标系旋转$R$并且平移$Q$的变换时相同的。

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113247233.png" alt="image-20240809113247233" style="zoom:50%;" />

下面总结一下齐次变换矩阵的三种解释：

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113307639.png" alt="image-20240809113307639" style="zoom:67%;" />

1. 它是位姿的描述。
2. 它是变换映射。
3. 它是变换算子。

由此可见，位姿和变换都可以用位置矢量加上姿态来描述。一般而言，位姿主要用于描述，变换常用来表示映射或算子。变换是平移和旋转的一般形式与蕴含。

### 2.6 变换的计算

变换的乘法和变换的逆运算共同构成了功能完备的变换算子。

#### 复合变换

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113321965.png" alt="image-20240809113321965" style="zoom:50%;" />

如上图所示，已知$^CP$，求$^AP$。经过两次变换，得到：
$$
^AP={^A_BT}{^B_CT}{^CP}
$$
由此定义复合变换$^A_CT={^A_BT}{^B_CT}$，可以发现，使用上下标可以简化运算。由于已知${^A_BT},{^B_CT}$，因此：
$$
^A_CT=\left(\begin{array}{ccc:c} & {^A_BR}{^B_CR}& &^A_BR{^BP_{CORG}}+{^AP_{BORG}} \\\hdashline0& 0& 0&1 \end{array}\right)\label{eq2.41}\tag{2.41}
$$

#### 逆变换

已知坐标系$\{B\}$相对于坐标系$\{A\}$的描述$^A_BT$，希望求出坐标系$\{A\}$相对于坐标系$\{B\}$的描述$^B_AT$，理论上只需要对$^A_BT$求逆即可，但是这样子并没有充分利用变换的性质。

根据上面的内容，有$^B_AR={^A_BR^T}$，其次利用$^BP={^B_AR{^AP}}+{^BP_{AORG}}$，令其中的$^AP$就是$\{B\}$在$\{A\}$中的平移矢量$^AP_{BORG}$，那么我们有$^B(^AP_{BORG})={^B_AR{^AP_{BORG}}}+{^BP_{AORG}}$，不难发现这个式子的左边为$0$（因为一个坐标系相对于它自己的平移矢量一定是$0$），那么有${^BP_{AORG}}=-{^B_AR{^AP_{BORG}}}=-{^A_BR^T {^AP_{BORG}}}$，于是根据定义，即可写出：
$$
^B_AT=\left(\begin{array}{ccc:c} & {^A_BR}^T& & -{^A_BR^T {^AP_{BORG}}}\\\hdashline0& 0& 0&1 \end{array}\right)\label{eq2.45}\tag{2.45}=^A_BT^{-1}
$$
于是只要知道$^A_BT$，也即知道${^A_BR},^AP_{BORG}$即可通过$\ref{eq2.45}$直接计算出逆变换$^B_AT$，其优势相比直接求逆，可以减少计算量。

### 2.7 变换方程

由变换构成的方程称为变换方程。如下图，从坐标系$\{U\}$出发，有两种方式得到坐标系$\{D\}$，也即：
$$
{^U_AT}{^A_DT}={^U_BT}{^B_CT}{^C_DT}
$$
可以发现，由于变换都是满秩的，因此可以从上式中解出任何一个未知的变换。

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113339176.png" alt="image-20240809113339176" style="zoom:50%;" />

在图形表示法中，箭头的方向指明了坐标系定义的方式，从一个坐标系出发，沿着箭头，即可得到任一与之串联的坐标系的变换，如果过程中有一个箭头方向相反，则只需求逆。对于如下图的一系列坐标系，从$\{U\}$出发，有两种方式得出它到$\{C\}$的变换。他们是等价的：
$$
{^U_CT}={^U_AT}{^D_AT^{-1}}{^D_CT}\\
{^U_CT}={^U_BT}{^B_CT}
$$
<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113412383.png" alt="image-20240809113412383" style="zoom:50%;" />

通过上述方法，即可便捷的求出串联起来的坐标系的复合变换。

### 2.8 其他姿态描述

根据线性代数中正交矩阵的凯莱公式，任何一个正交矩阵$R$都存在一个反对称矩阵$S$（$S=-S^T$）使得：
$$
R=(I-S)^{-1}(I+S)
$$
由于三维反对称矩阵可以表示为：
$$
S=\left(\begin{array}{ccc} 0&-s_z&s_y\\s_z&0&-s_x\\-s_y&s_x&0 \end{array}\right)
$$
因此任何一个$3\times3$的旋转矩阵都可以仅有三个参数唯一确定。据此，可以给出一些仅仅通过三个参数就能够确定旋转矩阵的表达方式。

#### X-Y-Z固定角

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113456721.png" alt="image-20240809113456721" style="zoom:50%;" />

通过以下操作得到$\{B\}$：首先让$\{B\}$与**固定坐标系**$\{A\}$重合。第一步让$\{B\}$绕$\hat X_A$旋转$\gamma$，第二步让$\{B\}$绕$\hat Y_A$旋转$\beta$，最后让$\{B\}$绕$\hat Z_A$旋转$\alpha$。将这种表示方式称作**X-Y-Z固定角**，分别称$\gamma,\beta,\alpha$作**回转角**、**俯仰角**和**偏转角**（注意，不同地方可能会有不同的定义）。直接推导对应的旋转矩阵：

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113507833.png" alt="image-20240809113507833" style="zoom:50%;" />

最重要的是搞清楚式2.63中的旋转顺序，先旋转的算子在右边，左侧依次乘以后旋转的算子。如果旋转顺序发生变化，则上面的两个式子不一定正确！

如果已知某个旋转矩阵，也可以反求等价的X-Y-Z固定角，将该旋转矩阵的元素记作$r_{ij},i,j=1,2,3$，那么可以求解得到：

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113523341.png" alt="image-20240809113523341" style="zoom:50%;" />

其中$\text{Atan2}(y,x)=\tan^{-1}(\frac y x)$是双参变量的反正切函数，根据$x,y$的符号可以判别角的象限，如$\text{Atan2}(-1,-1)=-135°$，而$\text{Atan2}(1,1)=45°$。

在式2.66中取$\beta$的正根即可得到单解，也即满足$-90°\le\beta\le90°$。这样就可以在各种姿态表示方法中定义一一对应的映射函数。在某些特殊情况下，有必要求出所有解（第4章）。如果$\beta=\pm 90°$，则意味者$c\beta=0$，那么式2.66就会退化，此时只能求出$\alpha,\gamma$的和或差。通常。直接令$\alpha=0$，此时：

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113533848.png" alt="image-20240809113533848" style="zoom:50%;" />

#### Z-Y-X欧拉角

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113550221.png" alt="image-20240809113550221" style="zoom:50%;" />

通过以下操作得到$\{B\}$：首先让$\{B\}$与**固定坐标系**$\{A\}$重合。第一步让$\{B\}$绕$\hat Z_B$旋转$\alpha$，第二步让$\{B\}$绕$\hat Y_B$旋转$\beta$，最后让$\{B\}$绕$\hat X_B$旋转$\gamma$。将这种表示方式称作**Z-Y-X固定角**。注意，每次旋转都是绕运动坐标系的各轴旋转，因此每次旋转所绕的轴的姿态取决于上一次的旋转。如图2.18所示，每次旋转后在新得到的坐标系轴上加上一撇，欧拉角的旋转矩阵用$^A_BR_{Z^\prime Y^\prime X^\prime}(\alpha,\beta,\gamma)$表示，加撇号是为了表明这是基于欧拉角描述的旋转。借助中间坐标系$\{B^\prime\},\{B^{\prime\prime}\}$推导旋转矩阵，也即$^A_BR={^A_{B^\prime}R}{^{B^\prime}_{B^{\prime\prime}}R}{^{B^{\prime\prime}}_BR}$：

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113601918.png" alt="image-20240809113601918" style="zoom:50%;" />

值得注意的是这个结果与以**相反顺序**绕固定轴旋转三次得到的结果完全相同。可以证明：三次绕固定轴旋转的最终姿态和以**相反顺序**绕运动坐标轴旋转的最终姿态相同。也即式2.71和2.64等价，同时2.66式也可以用来反求已知旋转矩阵所对应的Z-Y-X欧拉角。在具体计算时，可以发现，绕固定角旋转都是先转的角度的旋转矩阵在右侧，而绕运动坐标轴旋转时则是先转的角度的旋转矩阵在左侧，这是计算对应旋转矩阵时的一个小技巧。

#### Z-Y-Z欧拉角

通过以下操作得到$\{B\}$：首先让$\{B\}$与**固定坐标系**$\{A\}$重合。第一步让$\{B\}$绕$\hat Z_B$旋转$\alpha$，第二步让$\{B\}$绕$\hat Y_B$旋转$\beta$，最后让$\{B\}$绕$\hat Z_B$旋转$\gamma$。将这种表示方式称作**Z-Y-Z固定角**。可以推出：

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113616834.png" alt="image-20240809113616834" style="zoom:50%;" />

从旋转矩阵反求Z-Y-Z欧拉角的公式（要求满足$0\le\beta\le180°$，则可得到单解）：

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113625882.png" alt="image-20240809113625882" style="zoom:50%;" />

若$\beta=0,180°$，式2.74同样会出现退化，此时一般要求$\alpha=0$，于是就有：

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113633859.png" alt="image-20240809113633859" style="zoom:50%;" />

#### 其他转角组合

上文中已经介绍了三种典型的姿态表示方法，它们是24种表示法中的典型方法，都被称作**转角排列设定法**，其中12种固定角，以及12种与之对偶的欧拉角。具体表示方式不再赘述，可参考相关文档。

#### 等效角度——轴线表示法

上面提到过绕着坐标系主轴进行旋转，如果转轴是一般方向，则任何姿态都可以通过选择适当的转轴和角度来得到。也即：首先将坐标系$\{B\}$和一个已知的参考坐标系$\{A\}$重合，将其绕矢量$^A\hat K$按照右手定则旋转$\theta$角。矢量$K$被称作有限旋转的等效轴。$\{B\}$相对于$\{A\}$的一般姿态可以用$^A_BR(\hat K,\theta)$或$R_K(\theta)$表示，将其称作等效角度—轴线表示。

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113700333.png" alt="image-20240809113700333" style="zoom:50%;" />

如果选择$\{A\}$的主轴之一作为旋转轴，则等效旋转矩阵变成了以下三个旋转矩阵：

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113711236.png" alt="image-20240809113711236" style="zoom:50%;" />

如果旋转轴是任意的$^A\hat K=(k_x,k_y,k_z)^T$，令$v\theta=1-c\theta$，$\theta$的正向由右手法则给出，那么等效旋转矩阵为：

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113720847.png" alt="image-20240809113720847" style="zoom:60%;" />

给定一个旋转矩阵，反求出$\hat K,\theta$的步骤如下：

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113734577.png" alt="image-20240809113734577" style="zoom:60%;" />

由上式总可以计算出一个介于0°到180°之间的$\theta$，并且对于任意的$(\hat K,\theta)$，都存在$(-\hat K,-\theta)$，它们在空间中的姿态相同。注意，对于小角度旋转，旋转轴有可能变得不确定，显然，如果转动量为0或180°，则根本无法确定旋转轴，也即式2.82无解！

下面的例子给出了一个绕经过参考坐标系原点的轴进行旋转的位姿描述。不难发现，只有姿态发生了变化，而位置不变。

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113749254.png" alt="image-20240809113749254" style="zoom:50%;" />

下面的例子则是一个绕不过参考坐标系原点的轴进行旋转的位姿描述，我们需要额外定义两个坐标系$\{A^\prime\},\{B^\prime\}$，它们互相重合并且与坐标系$\{A\},\{B\}$的姿态相同，但是它们的原点在旋转轴线上，并且相对于坐标系$\{A\}$的原点有一定位移。那么我们可以依次写出$^A_{A^\prime}T$和$^{B^\prime}_{B}T$，它们只包含位移部分。同时可以得到$^{A^\prime}_{B^\prime}T$，它本质上是上面提到的绕参考坐标系原点的轴的纯旋转，所以不存在位置部分。于是，根据串联变换方程，即可得到$^A_BT$。

![image-20240809113801349](https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113801349.png)

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113808490.png" alt="image-20240809113808490" style="zoom:60%;" />

从上面的例子可以发现，绕一个不通过原点的轴旋转会导致位置和姿态同时发生变化，姿态变化与旋转轴线通过参考坐标系原点的旋转所引起的姿态变化一样。处理时，只需要借助原点位于旋转轴线上的两个辅助坐标系即可。

#### 欧拉参数（四元数）

根据等效旋转轴$\hat K=(k_x,k_y,k_z)^T$和等效旋转角$\theta$可得欧拉参数如下：
$$
\varepsilon_1=k_x\sin\frac\theta 2\\
\varepsilon_2=k_y\sin\frac\theta 2\\
\varepsilon_3=k_z\sin\frac\theta 2\\
\varepsilon_4=\cos\frac \theta2
$$
不难发现，它们彼此并不独立，也即满足$\sum\varepsilon_i^2=1$，因此可以将其视作是四维空间中单位超球面上的一点，满足$\varepsilon_i\in[-1,1]$。

用欧拉参数表示旋转矩阵$R_\varepsilon$：

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113827107.png" alt="image-20240809113827107" style="zoom:67%;" />

同样的，给定旋转矩阵，可以得到对应的欧拉参数：

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809113835095.png" alt="image-20240809113835095" style="zoom:60%;" />

实际上，应该指出，使用四元数表示旋转是一种比旋转矩阵更好的方式，它具有很多优势，但是限于作者的水平有限，此处不再展开有关四元数和更进一步的对偶四元数（能够同时表示旋转和平移）的讨论，相关内容请参考[四元数详细介绍](http://in.ruc.edu.cn/wp-content/uploads/2021/01/quaternion.pdf)一文，这篇文档对四元数进行了十分详细的介绍。

### 2.9 自由矢量的变换

首先要区分矢量的**相等**和**等效**。如果两个矢量具有相同的维数、大小和方向，则称其相等，但是它们的作用线可能不同，如下图所示。如果两个矢量在某一功能上产生了相同的作用效果，那么这两个矢量在这一特定功能上就是等效的。等效取决于具体的判断条件，如果判断运行距离，则图中三个矢量等效；如果判断运行结束后的位置，则三个矢量不等效。

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809114224807.png" alt="image-20240809114224807" style="zoom:50%;" />

定义**线矢量**：与作用线有关的矢量，其作用效果取决于矢量的大小和方向，如力矢量。再定义**自由矢量**：可能出现在空间任意位置的矢量，如果它的大小和方向保持不变，那么它的作用效果就不变，如纯力矩矢量和速度矢量。例如，在坐标系$\{B\}$中的速度矢量$^BV$，在坐标系$\{A\}$中的表示为$^AV=^A_BR{^BV}$，也即只与坐标系的旋转有关，而位置矢量变换的$^AP_{BORG}$则不能出现在速度变换中。关于速度矢量、力矢量和力矩矢量的更多介绍在第5章。

### 2.10 计算问题

齐次变换是一个重要的概念，但是在计算是一般不会直接对$4\times4$的齐次变换矩阵进行乘法或求逆，而是使用式$\ref{eq2.41},\ref{eq2.45}$，因为不能把时间浪费在0和1的乘法上。

计算顺序对于计算量的影响也很显著。如对于式2.95的计算，按照2.96先把三个旋转矩阵乘在一起需要63次乘法和42次加法，而按照2.97从右向左乘，只需要27次乘法和18次加法。但是，假如三个旋转矩阵是常数，而每次变化的是$^DP$，那么先把三个旋转矩阵乘在一起，而后直接使用新的旋转矩阵$^A_DR$，无疑对于大量的$^DP_i$而言，会更有效率。所以，在加快计算速度方面，需要具体问题具体分析。

<img src="https://mzhh.oss-cn-beijing.aliyuncs.com/img/image-20240809114241249.png" alt="image-20240809114241249" style="zoom:50%;" />

需要指出，在MATLAB和Corke所编写的Robotics工具箱中，有许多内置的完成本章中各种变换计算的函数，如[Coordinate Transformations and Trajectories - MATLAB & Simulink - MathWorks 中国](https://ww2.mathworks.cn/help/releases/R2023b/nav/coordinate-system-transformations.html?s_tid=CRUX_lftnav)提供了MATLAB官方的矩阵变换函数文档。以及Corke的工具箱相关文档[Robotics Toolbox - Peter Corke](https://petercorke.com/toolboxes/robotics-toolbox/)。