# 02-8-2 CFS 执行逻辑

## 单节点CFS

实现单臂的过程中暂时不考虑多臂的情况，患得患失反而写不出代码。

每个单节点 CFS 中复杂整理收集约束并形成约束枚举类型，最后将该约束类型交给 求解器 求解。

- 验证目标状态末端是否安全，如果不安全直接返回。
- 验证每个时间步的是否安全，如果安全的话则不需要进行约束，直接返回即可。这个过程将相当快速。
- 对每个时间步构建约束
  - 计算梯度，实际上是计算每个时间步对每个障碍物在关节空间的梯度。
  - 构建线性不等式约束，这里的线性约束很简单，就是机械臂每个关节到障碍物的距离大于某个安全阈值就行了。他们原有的变量记为 margin。
- 将约束提交给求解器求解

其中需要哪些工具？

- 安全检查器： 输入自由度数的关节角度，输出安全与否
- 安全距离数值梯度计算器： 输入自由度数量的关节角度和待计算障碍物的位置，输出自由度数的梯度
- 机器人自身所代表的障碍物快：输入自由度数量的关节角度，输出每个障碍快所对应的胶囊
- 距离计算器：输入两个胶囊，输出两个胶囊之间的位置
- 约束类型枚举：在求解器和规划器之间传递约束用的枚举类型，是一种消息类型，其中每个独立的消息包就应该能够独立实现一个约束问题，但是消息传递本身不应该携带过大的体积，大体积的常量矩阵应该交给求解器处理。

其中距离计算器交给sbgg处理。安全检查器和数值梯度计算器都依赖于

## 获取机器人胶囊

通过DH矩阵获取机器人自身所代表的胶囊，只有串联机器人具备这个功能。

## 距离计算器

距离计算器已由sbgg实现，需要检查其有效性。

安全距离数值梯度计算器
